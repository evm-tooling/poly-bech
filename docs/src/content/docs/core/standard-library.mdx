---
title: Standard Library
description: Built-in modules for Ethereum node spawning, chart generation, and mathematical constants
---

<div data-pagefind-weight="10">

poly-bench includes a standard library with modules for common benchmarking tasks. Import them at the top of your `.bench` file with the `use` keyword before any suite or globalSetup blocks.

<CodeGroup 
  tabs={[
    {
      title: "Imports",
      language: "bench",
      code: `use std::anvil      # Ethereum node spawning
use std::charting   # SVG chart generation
use std::constants  # Mathematical constants`
    },
  ]}
/>

</div>

---

### std::anvil

The `anvil` module provides Ethereum node spawning for RPC benchmarks. It manages a local [Anvil](https://book.getfoundry.sh/anvil/) instance that all languages can connect to via a shared RPC URL.

<Aside type="note">
<span>Anvil is a fast local Ethereum node from the Foundry toolkit. poly-bench handles spawning, port allocation, and cleanup automatically — you only need to call the directives.</span>
</Aside>

#### `anvil.spawnAnvil()`

Spawns a local Anvil instance. Call this inside a `globalSetup` block (file-level or suite-level).

<CodeGroup 
  tabs={[
    {
      title: "Syntax",
      language: "bench",
      code: `globalSetup {
    anvil.spawnAnvil()                           # Local node, no fork
    anvil.spawnAnvil(fork: "https://rpc.url")    # Fork from an RPC endpoint
}`
    },
  ]}
/>

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `fork` | string | No | RPC URL to fork from (e.g. mainnet, Sepolia, Arbitrum) |

#### `ANVIL_RPC_URL`

After `spawnAnvil()` is called, the local RPC endpoint is automatically injected into your setup code. The typical value is `http://127.0.0.1:8545`.

| Language | Access |
|----------|--------|
| TypeScript | `ANVIL_RPC_URL` — injected as a module-level constant in `declare` scope |
| Go | `os.Getenv("ANVIL_RPC_URL")` or pass directly as a string |
| Rust | `std::env::var("ANVIL_RPC_URL").unwrap()` |

#### `anvil.stopAnvil()`

Stops the running Anvil instance. Not required — poly-bench cleans up the process automatically — but useful for explicit teardown in long-running suites.

<CodeGroup 
  tabs={[
    {
      title: "Syntax",
      language: "bench",
      code: `after {
    anvil.stopAnvil()
}`
    },
  ]}
/>

#### Full Anvil Example

<CodeGroup 
  tabs={[
    {
      title: "anvil.bench",
      language: "bench",
      code: `use std::anvil

globalSetup {
    anvil.spawnAnvil(fork: "https://eth.llamarpc.com")
}

declare suite evmBench performance timeBased sameDataset: true {
    description: "EVM RPC benchmarks against a forked mainnet node"
    compare: true
    baseline: "go"
    targetTime: 10000ms
    cvThreshold: 10

    setup go {
        import (
            "context"
            "github.com/ethereum/go-ethereum/ethclient"
        )

        declare {
            var client *ethclient.Client
            var ctx context.Context
        }

        init {
            ctx = context.Background()
            client, _ = ethclient.Dial(os.Getenv("ANVIL_RPC_URL"))
        }

        helpers {
            func getBlockNumber() uint64 {
                num, _ := client.BlockNumber(ctx)
                return num
            }
        }
    }

    setup ts {
        import {
            import { createPublicClient, http } from 'viem'
            import { mainnet } from 'viem/chains'
        }

        declare {
            let client: any
        }

        init {
            client = createPublicClient({
                chain: mainnet,
                transport: http(ANVIL_RPC_URL),
            })
        }

        helpers {
            async function getBlockNumber(): Promise<bigint> {
                return await client.getBlockNumber()
            }
        }
    }

    bench getBlockNumber {
        description: "Get the current block number via RPC"
        go: getBlockNumber()
        ts: await getBlockNumber()
    }
}`
    },
  ]}
/>

---

### std::charting

The `charting` module generates SVG output from benchmark results. Chart directives must be called inside a suite-level `after { }` block and require `use std::charting` at the top of the file.

<CodeGroup 
  tabs={[
    {
      title: "Usage pattern",
      language: "bench",
      code: `use std::charting

declare suite example performance timeBased sameDataset: true {
    # ... setup, fixtures, benchmarks ...

    after {
        // [!code focus:4]
        charting.drawTable(title: "Results", output: "results-bar.svg")
        charting.drawSpeedupChart(
            title: "Speedup vs baseline",
            output: "results-speedup.svg",
            baselineBenchmark: "hashShort"
        )
    }
}`
    },
  ]}
/>

<Aside type="note">
<span>The <code>output</code> parameter controls the filename only. Files are written to the directory passed via <code>--output</code>, or to <code>out/</code> when omitted.</span>
</Aside>

---

#### `charting.drawTable(...)`

Generates an SVG summary table for benchmark results.

<CodeGroup 
  tabs={[
    {
      title: "Full syntax",
      language: "bench",
      code: `charting.drawTable(
    // [!code focus:7]
    title: "Performance Comparison",
    description: "Go vs TypeScript vs Rust",
    output: "results-table.svg",
    sortBy: "speedup",
    sortOrder: "desc",
    showStats: true,
    showGeoMean: true,
)`
    },
  ]}
/>

##### `drawTable` Parameter Reference

**Basic**

| Parameter | Type | Default | Description |
|-----------|------|---------|-------------|
| `title` | string | — | Chart title |
| `description` | string | — | Subtitle / description text |
| `output` | string | — | Output filename (e.g. `"results.svg"`) |
| `width` | integer | — | Chart width in pixels |
| `height` | integer | — | Chart height in pixels |

**Display Toggles**

| Parameter | Type | Default | Description |
|-----------|------|---------|-------------|
| `showStats` | boolean | `true` | Show statistical summary panel |
| `showConfig` | boolean | `true` | Show suite configuration panel |
| `showWinCounts` | boolean | `true` | Show win-count badges per language |
| `showGeoMean` | boolean | `true` | Show geometric mean bar |
| `compact` | boolean | `false` | Compact layout with reduced padding |

**Filtering**

| Parameter | Type | Default | Description |
|-----------|------|---------|-------------|
| `minSpeedup` | float | — | Only include benchmarks where the fastest language is at least this much faster than the slowest |
| `filterWinner` | string | `"all"` | Only include benchmarks won by this language (`"go"`, `"ts"`, `"rust"`, `"python"`, `"c"`, `"csharp"`, `"zig"`, or `"all"`) |
| `includeBenchmarks` | string[] | — | Whitelist of benchmark names to include |
| `excludeBenchmarks` | string[] | — | Blacklist of benchmark names to exclude |
| `limit` | integer | — | Maximum number of benchmarks to display |

**Sorting**

| Parameter | Type | Default | Description |
|-----------|------|---------|-------------|
| `sortBy` | string | — | Sort key: `"speedup"`, `"name"`, `"time"`, `"ops"`, `"natural"` |
| `sortOrder` | string | — | `"asc"` or `"desc"` |

**Typography + Values**

| Parameter | Type | Default | Description |
|-----------|------|---------|-------------|
| `titleFontSize` | integer | — | Title font size in points |
| `subtitleFontSize` | integer | — | Subtitle/description font size in points |
| `precision` | integer | — | Decimal places for displayed values |
| `timeUnit` | string | `"auto"` | Time unit: `"auto"`, `"ns"`, `"us"`, `"ms"`, `"s"` |

---

#### `charting.drawSpeedupChart(...)`

Generates a speedup chart for benchmark comparison views.

<CodeGroup 
  tabs={[
    {
      title: "Example",
      language: "bench",
      code: `charting.drawSpeedupChart(
    // [!code focus:7]
    title: "Speedup vs Go baseline",
    description: "How each benchmark compares to baseline",
    output: "results-speedup.svg",
    baselineBenchmark: "hashShort",  # alias: baseline
    sortBy: "speedup",
    showGrid: true,
    gridOpacity: 0.15,
    legendPosition: "top-right"
)`
    },
  ]}
/>

##### `drawSpeedupChart` Parameter Reference

| Parameter | Type | Description |
|-----------|------|-------------|
| `title` | string | Chart title |
| `description` | string | Subtitle text |
| `output` | string | Output filename |
| `width` | integer | Chart width in pixels |
| `height` | integer | Chart height in pixels |
| `baselineBenchmark` / `baseline` | string | Benchmark used as baseline |
| `minSpeedup` | float | Minimum speedup threshold for inclusion |
| `filterWinner` | string | Filter by winning language |
| `includeBenchmarks` | string[] | Whitelist of benchmark names |
| `excludeBenchmarks` | string[] | Blacklist of benchmark names |
| `limit` | integer | Maximum benchmarks to display |
| `sortBy` | string | Sort key: `"speedup"`, `"name"`, `"time"`, `"ops"`, `"natural"` |
| `sortOrder` | string | `"asc"` or `"desc"` |
| `showGrid` | boolean | Show horizontal grid lines |
| `gridOpacity` | float | Grid line opacity (0.0-1.0) |
| `titleFontSize` | integer | Title font size |
| `subtitleFontSize` | integer | Subtitle font size |
| `axisLabelFontSize` | integer | Axis label font size |
| `tickLabelFontSize` | integer | Tick label font size |
| `legendPosition` | string | `"top-left"`, `"top-right"`, `"bottom-left"`, `"bottom-right"`, `"hidden"` |
| `theme` | string | `"dark"` or `"light"` |
| `precision` | integer | Decimal places for values |
| `timeUnit` | string | Time unit for display |

---

#### Multiple Charts

You can generate any number of charts in a single `after` block. Each call produces a separate SVG file.

<CodeGroup 
  tabs={[
    {
      title: "Multiple charts",
      language: "bench",
      code: `use std::charting

declare suite comprehensive performance timeBased sameDataset: true {
    # ... benchmarks ...

    after {
        # Grouped table for overall comparison
        charting.drawTable(
            title: "Overall Performance",
            output: "results-table.svg",
            sortBy: "speedup",
            sortOrder: "desc",
            showStats: true
        )

        # Speedup chart relative to a baseline benchmark
        charting.drawSpeedupChart(
            title: "Speedup vs baseline",
            output: "results-speedup.svg",
            baselineBenchmark: "hashShort",
            showGrid: true
        )
    }
}`
    },
  ]}
/>

---

### std::constants

The `constants` module provides common mathematical constants for use in benchmark expressions and helper functions.

#### Available Constants

| Constant | Value | Description |
|----------|-------|-------------|
| `std_PI` (Go/TS/Python), `STD_PI` (Rust) | 3.14159265358979... | Pi (π) |
| `std_E` (Go/TS/Python), `STD_E` (Rust) | 2.71828182845904... | Euler's number (e) |

<CodeGroup 
  tabs={[
    {
      title: "Example",
      language: "bench",
      code: `use std::constants

declare suite mathBenchmarks performance timeBased sameDataset: true {
    setup go {
        helpers {
            func circleArea(radius float64) float64 {
                // [!code focus]
                return std_PI * radius * radius
            }
        }
    }

    setup ts {
        helpers {
            function circleArea(radius: number): number {
                // [!code focus]
                return std_PI * radius * radius
            }
        }
    }

    setup rust {
        helpers {
            fn circle_area(radius: f64) -> f64 {
                // [!code focus]
                STD_PI * radius * radius
            }
        }
    }

    bench area {
        go: circleArea(10.0)
        ts: circleArea(10.0)
        rust: circle_area(10.0)
    }
}`
    },
  ]}
/>

<Aside type="note">
<span>Constant symbol names are language-specific in generated code: Go/TypeScript/Python use <code>std_PI</code>/<code>std_E</code>, while Rust uses <code>STD_PI</code>/<code>STD_E</code>.</span>
</Aside>

---

### Module Summary

| Module | Import | Key Functions / Constants |
|--------|--------|--------------------------|
| `std::anvil` | `use std::anvil` | `spawnAnvil()`, `stopAnvil()`, `ANVIL_RPC_URL` |
| `std::charting` | `use std::charting` | `drawTable()`, `drawSpeedupChart()` |
| `std::constants` | `use std::constants` | `std_PI`/`STD_PI`, `std_E`/`STD_E` |

---

### Further Reading

- [DSL Reference](/docs/core/dsl-reference) — Complete `.bench` file syntax
- [Benchmark Features](/docs/examples) — Fixtures, hooks, globalSetup, charting
- [CLI Reference](/docs/tools/cli) — Command-line options
