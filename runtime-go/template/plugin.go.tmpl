// Code generated by poly-bench. DO NOT EDIT.
//
// This is a Go plugin containing benchmark implementations.
// It exports symbols that can be loaded and called by the poly-bench runtime.

package main

import (
	"encoding/json"
	"time"
)

// BenchResult holds the benchmark measurement results
type BenchResult struct {
	Iterations  uint64   `json:"iterations"`
	TotalNanos  uint64   `json:"total_nanos"`
	NanosPerOp  float64  `json:"nanos_per_op"`
	OpsPerSec   float64  `json:"ops_per_sec"`
	BytesPerOp  uint64   `json:"bytes_per_op"`
	AllocsPerOp uint64   `json:"allocs_per_op"`
	Samples     []uint64 `json:"samples,omitempty"`
}

// Exported plugin symbols
var (
	// RunBenchmark executes a benchmark by name and returns JSON results
	RunBenchmark = runBenchmark
	
	// ListBenchmarks returns a JSON array of available benchmark names
	ListBenchmarks = listBenchmarks
)

{{/* User-provided setup code */}}
{{- if .Setup }}
{{ .Setup }}
{{- end }}

{{/* Fixture definitions */}}
{{- range .Fixtures }}
// Fixture: {{ .Name }}
{{- if .Description }}
// {{ .Description }}
{{- end }}
var {{ .Name }} = {{ .GoCode }}
{{- end }}

{{/* Benchmark functions */}}
{{- range .Benchmarks }}
// Benchmark: {{ .Name }}
{{- if .Description }}
// {{ .Description }}
{{- end }}
func bench_{{ .FullName }}(iterations int) BenchResult {
	samples := make([]uint64, iterations)
	
	// Warmup
	for i := 0; i < {{ .Warmup }}; i++ {
		_ = {{ .GoCode }}
	}
	
	// Timed run
	var totalNanos uint64
	for i := 0; i < iterations; i++ {
		start := time.Now()
		_ = {{ .GoCode }}
		elapsed := time.Since(start).Nanoseconds()
		samples[i] = uint64(elapsed)
		totalNanos += uint64(elapsed)
	}
	
	nanosPerOp := float64(totalNanos) / float64(iterations)
	opsPerSec := 1e9 / nanosPerOp
	
	return BenchResult{
		Iterations:  uint64(iterations),
		TotalNanos:  totalNanos,
		NanosPerOp:  nanosPerOp,
		OpsPerSec:   opsPerSec,
		Samples:     samples,
	}
}
{{- end }}

func runBenchmark(name string, iterations int) string {
	var result BenchResult

	switch name {
{{- range .Benchmarks }}
	case "{{ .FullName }}":
		result = bench_{{ .FullName }}(iterations)
{{- end }}
	default:
		result = BenchResult{}
	}

	jsonBytes, _ := json.Marshal(result)
	return string(jsonBytes)
}

func listBenchmarks() string {
	names := []string{
{{- range .Benchmarks }}
		"{{ .FullName }}",
{{- end }}
	}
	jsonBytes, _ := json.Marshal(names)
	return string(jsonBytes)
}

func main() {}
